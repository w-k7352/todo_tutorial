# 基本設計書 v1.0 — ToDo管理Webアプリ

## 1. 概要

本ドキュメントは、「要件定義書 v1.0」に基づき、ToDo管理Webアプリケーションの基本設計を定義する。本アプリは、単一ページのフロントエンドアプリケーションとして動作し、個人のタスク管理と生産性向上を支援する。

## 2. システム構成

- **アーキテクチャ**: フロントエンドのみのSPA (Single Page Application)
- **使用技術**:
  - `HTML`: アプリケーションの構造を定義
  - `CSS`: スタイリングとレスポンシブデザインを担当
  - `JavaScript (Vanilla JS)`: アプリケーションのロジック全体を制御
- **データストア**: ブラウザの `localStorage` を使用し、クライアントサイドでデータを永続化する。

## 3. 画面設計 (UI)

単一画面で全ての機能を提供する。画面は主に3つのエリアで構成される。

1.  **ヘッダー・新規登録エリア (上部)**
    -   **タスクカウンタ**: 「未着手」「進行中」「完了」のタスク件数を表示する。
    -   **新規タスク入力フォーム**:
        -   タイトル入力欄 (`<input type="text">`)
        -   期限入力欄 (`<input type="date">`)
        -   タグ入力欄 (`<input type="text">`, カンマ区切り)
        -   登録ボタン

2.  **コントロールエリア (中段)**
    -   **フィルタリング機能**:
        -   キーワード検索欄
        -   タグ検索欄
        -   期限範囲指定 (開始日/終了日)
        -   ステータス選択 (ドロップダウン)
        -   フィルタクリアボタン
    -   **ソート機能**:
        -   ソート条件選択 (ドロップダウン: 期限昇順, 作成日 新→旧/旧→新, タイトルA→Z)
    -   **CSVエクスポートボタン**

3.  **タスク一覧エリア (下段)**
    -   **テーブル形式**でタスクを表示する。
    -   **表示項目**:
        -   チェックボックス (完了/未完トグル)
        -   タイトル (完了時は打消し線)
        -   ステータス (色分けされたバッジ)
        -   期限 (色分けされたバッジ: 期限切れ/本日/未来)
        -   タグ
        -   作成日時 / 更新日時
        -   操作ボタン (編集/削除)

## 4. 機能設計

### 4.1. モジュール構成

コードの保守性を高めるため、役割ごとにJavaScriptファイルを分割する。

-   `app.js`:
    -   アプリケーション全体のエントリーポイント。
    -   各モジュールの初期化とイベントリスナーの登録を行う。
    -   ユーザー操作に応じて、各機能を呼び出すコントローラーとして振る舞う。
-   `view.js`:
    -   DOM操作とUIの更新を専門に担当する。
    -   タスク一覧の描画、カウンタの更新、フォームのクリアなどを行う。
    -   `app.js` からの指示を受けて画面を変更する。
-   `taskRepository.js`:
    -   `localStorage` とのデータの読み書き (CRUD) を抽象化する。
    -   データの取得、保存、更新、削除のロジックをカプセル化し、他のモジュールが `localStorage` を直接意識しないようにする。
-   `utils.js`:
    -   日付のフォーマット、UUIDの生成、CSVのエスケープ処理など、プロジェクト全体で利用される共通関数を提供する。

### 4.2. 主要機能の実装方針

-   **タスク管理 (CRUD)**
    -   **作成 (Create)**: 新規登録フォームから入力値を取得し、`id` (UUID), `created_at`, `updated_at` を付与して `taskRepository` に保存を依頼する。
    -   **読み取り (Read)**: `taskRepository` から全タスクを取得し、`view` を通じて一覧に描画する。
    -   **更新 (Update)**: 編集操作（モーダルまたは行内編集）により、対象タスクのデータを更新し `taskRepository` に保存を依頼する。完了トグルも更新の一環として扱う。
    -   **削除 (Delete)**: 削除ボタン押下時に確認ダイアログを表示後、`taskRepository` に削除を依頼する。
-   **フィルタリング・ソート**
    -   ユーザーがフィルタ/ソート条件を変更するたびにイベントを発火。
    -   `app.js` が現在のフィルタ/ソート条件を基に `taskRepository` から取得したタスクリストを加工し、`view` に再描画を指示する。
    -   処理は全てクライアントサイドで完結させる。
-   **CSVエクスポート**
    -   現在のフィルタリング状態に関わらず、`localStorage` 内の**全タスクデータ**を対象とする。
    -   `taskRepository` から全データを取得し、`utils.js` のCSV生成関数を使ってCSV文字列を作成し、ダウンロードさせる。

## 5. データ設計

-   **ストレージキー**: `localStorage` にデータを保存する際のキー名は `todo_tasks_v1` とする。
-   **データスキーマ**: 1つのタスクは以下の構造を持つJSONオブジェクトとして表現し、配列として `localStorage` に保存する。

```json
{
  "id": "string",         // UUID v4
  "title": "string",        // 必須
  "due": "string | null",   // YYYY-MM-DD
  "tags": ["string"],     // タグの配列
  "status": "todo" | "doing" | "done",
  "created_at": "string", // ISO 8601
  "updated_at": "string"  // ISO 8601
}
```

## 6. 非機能要件への対応

-   **パフォーマンス**: 500件程度のタスクでも軽快に動作するよう、DOM操作は最小限に留める。イベントのたびに全件を再描画するのではなく、差分更新や効率的な描画手法を検討する。
-   **保守性**: 上記「4.1. モジュール構成」の通り、関心を分離した設計を採用する。特に `taskRepository.js` によりデータ操作を分離し、将来的なバックエンドへの移行を容易にする。
-   **アクセシビリティ**: `aria`属性の付与、キーボード操作（Tab, Enter, Esc）への対応、適切なコントラスト比の確保をCSS設計段階から考慮する。
-   **セキュリティ**: 全ての処理はクライアントサイドで完結し、外部へのデータ送信は行わない。入力値は表示前に適切にエスケープ処理を施し、XSSリスクを低減する。
